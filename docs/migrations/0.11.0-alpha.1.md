# Migration Guide: `0.11.0-alpha.1` (Fearless Refactor Snapshot)

This pre-release is part of the monorepo split + Vercel AI SDK-aligned refactor.
The goal is to keep `llm_dart` as a suite while making **subpackage-only** usage
first-class.

## What changed (high impact)

- **Phind removed from umbrella**
  - `llm_dart` no longer ships the Phind provider by default.
  - If you still need it, depend on `llm_dart_phind` and call `registerPhind()`.
  - The legacy OpenAI-compatible preset id `phind-openai` is not provided anymore; use provider id `phind`.
- **Core configuration escape hatches**
  - `LLMConfig.extensions` is removed.
  - Use `providerOptions` (provider-only knobs) and `transportOptions` (HTTP/transport).
- **Web search is no longer a “unified” feature**
  - `WebSearchConfig` and `LLMBuilder.enableWebSearch()/webSearch()` are removed.
  - Use provider-native tools via `providerTools` (recommended), or provider-specific
    `providerOptions` as a best-effort bridge.
- **Prompt building: prefer Prompt IR**
  - `ChatMessage.extensions` is deprecated for user code (reserved for protocol-internal blocks).
  - Use `Prompt` / `PromptMessage` / `PromptPart` from `llm_dart_ai` (or `llm_dart_core`) for
    app-level prompt construction.
- **Providers are split into independent packages**
  - Umbrella users can keep `llm_dart` for convenience.
  - Subpackage users should depend on `llm_dart_ai` + `llm_dart_builder` + the specific provider
    packages they need, and call `registerXxx()` to register factories.

## MiniMax (Anthropic-compatible)

- Default base URL now follows Vercel's MiniMax provider:
  - `https://api.minimax.io/anthropic/v1`
- MiniMax docs also use:
  - `https://api.minimax.io/anthropic`
- LLM Dart accepts both and normalizes to an Anthropic Messages-style `/v1/` base.

## Common migration recipes

### 1) Replace `extensions` with `providerOptions`

Old:

```dart
config = config.copyWith(extensions: {'thinkingBudgetTokens': 1024});
```

New:

```dart
config = config.copyWith(providerOptions: {
  'anthropic': {'thinkingBudgetTokens': 1024},
});
```

### 2) Subpackage-only usage (recommended going forward)

```dart
import 'package:llm_dart_ai/llm_dart_ai.dart';
import 'package:llm_dart_builder/llm_dart_builder.dart';
import 'package:llm_dart_minimax/llm_dart_minimax.dart';

Future<void> main() async {
  registerMinimax();

  final model = await LLMBuilder()
      .provider(minimaxProviderId)
      .apiKey('MINIMAX_API_KEY')
      .model(minimaxDefaultModel)
      .build();

  final result = await generateText(
    model: model,
    promptIr: Prompt(messages: [PromptMessage.user('Hello!')]),
  );

  print(result.text);
}
```

## Vercel-style prompt inputs (new)

Text/object tasks now accept Vercel-style prompt inputs:

- `system` + exactly one of: `prompt` / `messages` / `promptIr`

Examples:

```dart
final result = await generateText(
  model: model,
  system: 'You are a helpful assistant.',
  prompt: 'Hello!',
);
```

```dart
final result = await generateText(
  model: model,
  promptIr: Prompt(messages: [PromptMessage.user('Hello!')]),
);
```

Tool loop orchestration uses the same prompt inputs:

```dart
final outcome = await runToolLoopUntilBlocked(
  model: model,
  system: 'You are a helpful assistant.',
  prompt: 'Search and summarize the latest news about X.',
  tools: toolSet.tools,
  toolHandlers: toolSet.handlers,
  toolApprovalChecks: toolSet.approvalChecks,
);
```

Legacy helper aliases (still available for now) are no longer exported from
`package:llm_dart_ai/llm_dart_ai.dart`. If you still need them, import:

```dart
import 'package:llm_dart_ai/legacy.dart';
```

Umbrella users can also import `package:llm_dart/legacy.dart`.

- All `*FromPromptIr` / `*FromPrompt` helpers (e.g. `generateTextFromPromptIr`).

These aliases are deprecated and planned to be removed in `0.12.0-alpha.1`.

## More details

- Target architecture + MVPs: `docs/llm_dart_architecture.md`
- Standard surface definition: `docs/standard_surface.md`
- ADPs (stable decisions): `docs/adp/README.md`
- Next planned removals: `docs/migrations/0.12.0-alpha.1.md`
