# Migration Guide: `0.11.0-alpha.1` (Fearless Refactor Snapshot)

This pre-release is part of the monorepo split + Vercel AI SDK-aligned refactor.
The goal is to keep `llm_dart` as a suite while making **subpackage-only** usage
first-class.

## What changed (high impact)

- **Provider defaults moved out of `llm_dart_core`**
  - `ProviderDefaults` and `OpenAICompatibleDefaults` are removed from `llm_dart_core` to keep the core package provider-agnostic.
  - Import defaults from the relevant package:
    - OpenAI: `package:llm_dart_openai/defaults.dart`
    - Anthropic: `package:llm_dart_anthropic_compatible/defaults.dart`
    - Google: `package:llm_dart_google/defaults.dart`
    - Ollama: `package:llm_dart_ollama/defaults.dart`
    - ElevenLabs: `package:llm_dart_elevenlabs/defaults.dart`
    - OpenAI-compatible preset endpoints: `package:llm_dart_openai_compatible/defaults.dart`

  Example:

  Old:

  ```dart
  import 'package:llm_dart_core/core/provider_defaults.dart';

  final baseUrl = ProviderDefaults.openaiBaseUrl;
  ```

  New:

  ```dart
  import 'package:llm_dart_openai/defaults.dart';

  final baseUrl = openaiBaseUrl;
  ```

- **Legacy unified audio capability removed (Vercel-style)**
  - `AudioCapability`, `AudioFeature`, `AudioCapabilityAdapter`, and `LLMBuilder.buildAudio()` are removed.
  - Audio is now modeled as **task-level capabilities** (only implement what a provider actually supports):
    - `TextToSpeechCapability` (TTS)
    - `SpeechToTextCapability` (STT)
    - `AudioTranslationCapability` (audio → text translation, when supported)
    - `RealtimeAudioCapability` (realtime sessions, when supported)
  - Build task-specific capabilities instead:
    - `buildSpeech()` / `buildStreamingSpeech()`
    - `buildTranscription()`
    - `buildAudioTranslation()`
    - `buildRealtimeAudio()`
  - Capability detection:
    - Use task interface checks (e.g. `provider is TextToSpeechCapability`), or
    - Use `CapabilityUtils.getCapabilities(provider)` for a quick introspection list.
  - Convenience helpers:
    - `speech()` / `transcribeFile()` / `translateFile()` now live on task interfaces via extensions (see `packages/llm_dart_core/lib/core/capability.dart`).

- **Non-standard unified capabilities removed (Vercel-style narrowing)**
  - `FileManagementCapability`, `ModerationCapability`, `AssistantCapability`, `ModelListingCapability` are removed.
  - `LLMBuilder.buildFileManagement()` / `buildModeration()` / `buildAssistant()` / `buildModelListing()` are removed.
  - Use provider-specific APIs instead (example: OpenAI):
    - Build the provider with `build()`, then cast and call provider-specific modules.

- **Phind removed**
  - The Phind provider package has been removed from this repository.
  - The legacy OpenAI-compatible preset id `phind-openai` is not provided anymore.
- **Core configuration escape hatches**
  - `LLMConfig.extensions` is removed.
  - Use `providerOptions` (provider-only knobs) and `transportOptions` (HTTP/transport).
- **Web search is no longer a “unified” feature**
  - `WebSearchConfig` and `LLMBuilder.enableWebSearch()/webSearch()` are removed.
  - Use provider-native tools via `providerTools` (recommended), or provider-specific
    `providerOptions` as a best-effort bridge.
- **Prompt building: prefer Prompt IR**
  - `ChatMessage.extensions` is deprecated for user code (reserved for protocol-internal blocks).
  - Use `Prompt` / `PromptMessage` / `PromptPart` from `llm_dart_ai` (or `llm_dart_core`) for
    app-level prompt construction.
- **Providers are split into independent packages**
  - Umbrella users can keep `llm_dart` for convenience.
  - Subpackage users should depend on `llm_dart_ai` + `llm_dart_builder` + the specific provider
    packages they need, and call `registerXxx()` to register factories.
  - **Protocol reuse layers are not re-exported by provider packages** (boundary cleanup)
    - If you need protocol-level types, depend on the protocol packages directly:
      - Anthropic Messages protocol: `llm_dart_anthropic_compatible`
      - OpenAI-compatible protocol: `llm_dart_openai_compatible`
  - **Low-level provider HTTP utilities are opt-in** (boundary cleanup)
    - Provider packages no longer re-export `client.dart` / `dio_strategy.dart` from their main
      `<provider>.dart` entrypoints.
    - Import them explicitly when needed, for example:
      - `package:llm_dart_google/client.dart`
      - `package:llm_dart_google/dio_strategy.dart`
      - `package:llm_dart_openai_compatible/dio_strategy.dart`

- **OpenAI-specific models moved out of `llm_dart_core`**
  - `Assistant*` types and `ResponseInput*` types are OpenAI-only and no longer ship from the
    provider-agnostic `llm_dart_core` surface.
  - Import them from the OpenAI provider package instead:
    - `package:llm_dart_openai/assistants.dart` (assistant models)
    - `package:llm_dart_openai/responses.dart` (Responses API models)

## MiniMax (Anthropic-compatible)

- Default base URL now follows Vercel's MiniMax provider:
  - `https://api.minimax.io/anthropic/v1`
- MiniMax docs also use:
  - `https://api.minimax.io/anthropic`
- LLM Dart accepts both and normalizes to an Anthropic Messages-style `/v1/` base.

## Common migration recipes

### 1) Replace `extensions` with `providerOptions`

Old:

```dart
config = config.copyWith(extensions: {'thinkingBudgetTokens': 1024});
```

New:

```dart
config = config.copyWith(providerOptions: {
  'anthropic': {'thinkingBudgetTokens': 1024},
});
```

### 2) Audio: replace `buildAudio()` with task builders

Old:

```dart
final audio = await LLMBuilder()
    .provider(elevenLabsProviderId)
    .apiKey('ELEVENLABS_API_KEY')
    .buildAudio();

final out = await audio.speech(text: 'Hello!');
```

New:

```dart
final tts = await LLMBuilder()
    .provider(elevenLabsProviderId)
    .apiKey('ELEVENLABS_API_KEY')
    .buildSpeech();

final out = await tts.speech(text: 'Hello!');
```

### 3) Provider-specific APIs: replace removed unified builders

Old:

```dart
final moderation = await LLMBuilder()
    .provider(openaiProviderId)
    .apiKey('OPENAI_API_KEY')
    .buildModeration();

final result = await moderation.moderate(
  ModerationRequest(input: ['...']),
);
```

New (OpenAI example):

```dart
final provider = await LLMBuilder()
    .provider(openaiProviderId)
    .apiKey('OPENAI_API_KEY')
    .build();

final openai = provider as OpenAIProvider;
final result = await openai.moderationApi.moderate(
  ModerationRequest(input: ['...']),
);
```

### 4) Subpackage-only usage (recommended going forward)

```dart
import 'package:llm_dart_ai/llm_dart_ai.dart';
import 'package:llm_dart_builder/llm_dart_builder.dart';
import 'package:llm_dart_minimax/llm_dart_minimax.dart';

Future<void> main() async {
  registerMinimax();

  final model = await LLMBuilder()
      .provider(minimaxProviderId)
      .apiKey('MINIMAX_API_KEY')
      .model(minimaxDefaultModel)
      .build();

  final result = await generateText(
    model: model,
    promptIr: Prompt(messages: [PromptMessage.user('Hello!')]),
  );

  print(result.text);
}
```

## Vercel-style prompt inputs (new)

Text/object tasks now accept Vercel-style prompt inputs:

- `system` + exactly one of: `prompt` / `messages` / `promptIr`

Examples:

```dart
final result = await generateText(
  model: model,
  system: 'You are a helpful assistant.',
  prompt: 'Hello!',
);
```

```dart
final result = await generateText(
  model: model,
  promptIr: Prompt(messages: [PromptMessage.user('Hello!')]),
);
```

Tool loop orchestration uses the same prompt inputs:

```dart
final outcome = await runToolLoopUntilBlocked(
  model: model,
  system: 'You are a helpful assistant.',
  prompt: 'Search and summarize the latest news about X.',
  tools: toolSet.tools,
  toolHandlers: toolSet.handlers,
  toolApprovalChecks: toolSet.approvalChecks,
);
```

Legacy helper aliases (still available for now) are no longer exported from
`package:llm_dart_ai/llm_dart_ai.dart`. If you still need them, import:

```dart
import 'package:llm_dart_ai/legacy.dart';
```

Umbrella users can also import `package:llm_dart/legacy.dart`.

- All `*FromPromptIr` / `*FromPrompt` helpers (e.g. `generateTextFromPromptIr`).

These aliases are deprecated and planned to be removed in `0.12.0-alpha.1`.

## More details

- Target architecture + MVPs: `docs/llm_dart_architecture.md`
- Standard surface definition: `docs/standard_surface.md`
- ADPs (stable decisions): `docs/adp/README.md`
- Next planned removals: `docs/migrations/0.12.0-alpha.1.md`
